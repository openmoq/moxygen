From b8baae609dca295249a13145d2712898852b0728 Mon Sep 17 00:00:00 2001
From: Giovanni Marzot <gmarzot@marzresearch.net>
Date: Thu, 19 Feb 2026 18:42:24 -0500
Subject: [PATCH] Remove --allow-system-packages from macOS workflow

Homebrew glog 0.7+ has breaking API changes (GLOG_EXPORT, namespace
restructuring) that cause proxygen build failures when system glog
headers are used. Force getdeps to build all deps from source.

Co-Authored-By: Claude Opus 4.6 <noreply@anthropic.com>
---
 .github/workflows/getdeps_mac.yml | 130 +++++++++++++++---------------
 1 file changed, 65 insertions(+), 65 deletions(-)

diff --git a/.github/workflows/getdeps_mac.yml b/.github/workflows/getdeps_mac.yml
index bb2f311..c94e432 100644
--- a/.github/workflows/getdeps_mac.yml
+++ b/.github/workflows/getdeps_mac.yml
@@ -19,100 +19,100 @@ jobs:
     steps:
     - uses: actions/checkout@v4
     - name: Install system deps
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages install-system-deps --recursive moxygen
+      run: python3 build/fbcode_builder/getdeps.py install-system-deps --recursive moxygen
     - id: paths
       name: Query paths
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages query-paths --recursive --src-dir=. moxygen  >> "$GITHUB_OUTPUT"
+      run: python3 build/fbcode_builder/getdeps.py query-paths --recursive --src-dir=. moxygen  >> "$GITHUB_OUTPUT"
     - name: Fetch ninja
       if: ${{ steps.paths.outputs.ninja_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests ninja
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests ninja
     - name: Fetch cmake
       if: ${{ steps.paths.outputs.cmake_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests cmake
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests cmake
     - name: Fetch zlib
       if: ${{ steps.paths.outputs.zlib_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests zlib
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests zlib
     - name: Fetch zstd
       if: ${{ steps.paths.outputs.zstd_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests zstd
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests zstd
     - name: Fetch boost
       if: ${{ steps.paths.outputs.boost_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests boost
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests boost
     - name: Fetch double-conversion
       if: ${{ steps.paths.outputs.double-conversion_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests double-conversion
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests double-conversion
     - name: Fetch fast_float
       if: ${{ steps.paths.outputs.fast_float_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests fast_float
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fast_float
     - name: Fetch fmt
       if: ${{ steps.paths.outputs.fmt_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests fmt
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fmt
     - name: Fetch gflags
       if: ${{ steps.paths.outputs.gflags_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests gflags
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests gflags
     - name: Fetch glog
       if: ${{ steps.paths.outputs.glog_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests glog
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests glog
     - name: Fetch googletest
       if: ${{ steps.paths.outputs.googletest_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests googletest
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests googletest
     - name: Fetch libdwarf
       if: ${{ steps.paths.outputs.libdwarf_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libdwarf
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libdwarf
     - name: Fetch libevent
       if: ${{ steps.paths.outputs.libevent_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libevent
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libevent
     - name: Fetch lz4
       if: ${{ steps.paths.outputs.lz4_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests lz4
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests lz4
     - name: Fetch snappy
       if: ${{ steps.paths.outputs.snappy_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests snappy
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests snappy
     - name: Fetch openssl
       if: ${{ steps.paths.outputs.openssl_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests openssl
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests openssl
     - name: Fetch liboqs
       if: ${{ steps.paths.outputs.liboqs_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests liboqs
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests liboqs
     - name: Fetch autoconf
       if: ${{ steps.paths.outputs.autoconf_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests autoconf
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests autoconf
     - name: Fetch automake
       if: ${{ steps.paths.outputs.automake_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests automake
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests automake
     - name: Fetch libtool
       if: ${{ steps.paths.outputs.libtool_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libtool
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libtool
     - name: Fetch gperf
       if: ${{ steps.paths.outputs.gperf_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests gperf
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests gperf
     - name: Fetch libiberty
       if: ${{ steps.paths.outputs.libiberty_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libiberty
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libiberty
     - name: Fetch libsodium
       if: ${{ steps.paths.outputs.libsodium_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libsodium
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libsodium
     - name: Fetch libunwind
       if: ${{ steps.paths.outputs.libunwind_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests libunwind
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests libunwind
     - name: Fetch xz
       if: ${{ steps.paths.outputs.xz_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests xz
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests xz
     - name: Fetch folly
       if: ${{ steps.paths.outputs.folly_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests folly
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests folly
     - name: Fetch fizz
       if: ${{ steps.paths.outputs.fizz_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests fizz
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests fizz
     - name: Fetch mvfst
       if: ${{ steps.paths.outputs.mvfst_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests mvfst
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests mvfst
     - name: Fetch wangle
       if: ${{ steps.paths.outputs.wangle_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests wangle
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests wangle
     - name: Fetch proxygen
       if: ${{ steps.paths.outputs.proxygen_SOURCE }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fetch --no-tests proxygen
+      run: python3 build/fbcode_builder/getdeps.py fetch --no-tests proxygen
     - name: Restore ninja from cache
       id: restore_ninja
       if: ${{ steps.paths.outputs.ninja_SOURCE }}
@@ -122,7 +122,7 @@ jobs:
        key: ${{ steps.paths.outputs.ninja_CACHE_KEY }}-install
     - name: Build ninja
       if: ${{ steps.paths.outputs.ninja_SOURCE && ! steps.restore_ninja.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests ninja
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests ninja
     - name: Save ninja to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.ninja_SOURCE && ! steps.restore_ninja.outputs.cache-hit }}
@@ -138,7 +138,7 @@ jobs:
        key: ${{ steps.paths.outputs.cmake_CACHE_KEY }}-install
     - name: Build cmake
       if: ${{ steps.paths.outputs.cmake_SOURCE && ! steps.restore_cmake.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests cmake
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests cmake
     - name: Save cmake to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.cmake_SOURCE && ! steps.restore_cmake.outputs.cache-hit }}
@@ -154,7 +154,7 @@ jobs:
        key: ${{ steps.paths.outputs.zlib_CACHE_KEY }}-install
     - name: Build zlib
       if: ${{ steps.paths.outputs.zlib_SOURCE && ! steps.restore_zlib.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests zlib
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests zlib
     - name: Save zlib to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.zlib_SOURCE && ! steps.restore_zlib.outputs.cache-hit }}
@@ -170,7 +170,7 @@ jobs:
        key: ${{ steps.paths.outputs.zstd_CACHE_KEY }}-install
     - name: Build zstd
       if: ${{ steps.paths.outputs.zstd_SOURCE && ! steps.restore_zstd.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests zstd
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests zstd
     - name: Save zstd to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.zstd_SOURCE && ! steps.restore_zstd.outputs.cache-hit }}
@@ -186,7 +186,7 @@ jobs:
        key: ${{ steps.paths.outputs.boost_CACHE_KEY }}-install
     - name: Build boost
       if: ${{ steps.paths.outputs.boost_SOURCE && ! steps.restore_boost.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests boost
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests boost
     - name: Save boost to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.boost_SOURCE && ! steps.restore_boost.outputs.cache-hit }}
@@ -202,7 +202,7 @@ jobs:
        key: ${{ steps.paths.outputs.double-conversion_CACHE_KEY }}-install
     - name: Build double-conversion
       if: ${{ steps.paths.outputs.double-conversion_SOURCE && ! steps.restore_double-conversion.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests double-conversion
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests double-conversion
     - name: Save double-conversion to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.double-conversion_SOURCE && ! steps.restore_double-conversion.outputs.cache-hit }}
@@ -218,7 +218,7 @@ jobs:
        key: ${{ steps.paths.outputs.fast_float_CACHE_KEY }}-install
     - name: Build fast_float
       if: ${{ steps.paths.outputs.fast_float_SOURCE && ! steps.restore_fast_float.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests fast_float
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests fast_float
     - name: Save fast_float to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.fast_float_SOURCE && ! steps.restore_fast_float.outputs.cache-hit }}
@@ -234,7 +234,7 @@ jobs:
        key: ${{ steps.paths.outputs.fmt_CACHE_KEY }}-install
     - name: Build fmt
       if: ${{ steps.paths.outputs.fmt_SOURCE && ! steps.restore_fmt.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests fmt
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests fmt
     - name: Save fmt to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.fmt_SOURCE && ! steps.restore_fmt.outputs.cache-hit }}
@@ -250,7 +250,7 @@ jobs:
        key: ${{ steps.paths.outputs.gflags_CACHE_KEY }}-install
     - name: Build gflags
       if: ${{ steps.paths.outputs.gflags_SOURCE && ! steps.restore_gflags.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests gflags
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests gflags
     - name: Save gflags to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.gflags_SOURCE && ! steps.restore_gflags.outputs.cache-hit }}
@@ -266,7 +266,7 @@ jobs:
        key: ${{ steps.paths.outputs.glog_CACHE_KEY }}-install
     - name: Build glog
       if: ${{ steps.paths.outputs.glog_SOURCE && ! steps.restore_glog.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests glog
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests glog
     - name: Save glog to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.glog_SOURCE && ! steps.restore_glog.outputs.cache-hit }}
@@ -282,7 +282,7 @@ jobs:
        key: ${{ steps.paths.outputs.googletest_CACHE_KEY }}-install
     - name: Build googletest
       if: ${{ steps.paths.outputs.googletest_SOURCE && ! steps.restore_googletest.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests googletest
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests googletest
     - name: Save googletest to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.googletest_SOURCE && ! steps.restore_googletest.outputs.cache-hit }}
@@ -298,7 +298,7 @@ jobs:
        key: ${{ steps.paths.outputs.libdwarf_CACHE_KEY }}-install
     - name: Build libdwarf
       if: ${{ steps.paths.outputs.libdwarf_SOURCE && ! steps.restore_libdwarf.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libdwarf
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libdwarf
     - name: Save libdwarf to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libdwarf_SOURCE && ! steps.restore_libdwarf.outputs.cache-hit }}
@@ -314,7 +314,7 @@ jobs:
        key: ${{ steps.paths.outputs.libevent_CACHE_KEY }}-install
     - name: Build libevent
       if: ${{ steps.paths.outputs.libevent_SOURCE && ! steps.restore_libevent.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libevent
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libevent
     - name: Save libevent to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libevent_SOURCE && ! steps.restore_libevent.outputs.cache-hit }}
@@ -330,7 +330,7 @@ jobs:
        key: ${{ steps.paths.outputs.lz4_CACHE_KEY }}-install
     - name: Build lz4
       if: ${{ steps.paths.outputs.lz4_SOURCE && ! steps.restore_lz4.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests lz4
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests lz4
     - name: Save lz4 to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.lz4_SOURCE && ! steps.restore_lz4.outputs.cache-hit }}
@@ -346,7 +346,7 @@ jobs:
        key: ${{ steps.paths.outputs.snappy_CACHE_KEY }}-install
     - name: Build snappy
       if: ${{ steps.paths.outputs.snappy_SOURCE && ! steps.restore_snappy.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests snappy
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests snappy
     - name: Save snappy to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.snappy_SOURCE && ! steps.restore_snappy.outputs.cache-hit }}
@@ -362,7 +362,7 @@ jobs:
        key: ${{ steps.paths.outputs.openssl_CACHE_KEY }}-install
     - name: Build openssl
       if: ${{ steps.paths.outputs.openssl_SOURCE && ! steps.restore_openssl.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests openssl
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests openssl
     - name: Save openssl to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.openssl_SOURCE && ! steps.restore_openssl.outputs.cache-hit }}
@@ -378,7 +378,7 @@ jobs:
        key: ${{ steps.paths.outputs.liboqs_CACHE_KEY }}-install
     - name: Build liboqs
       if: ${{ steps.paths.outputs.liboqs_SOURCE && ! steps.restore_liboqs.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests liboqs
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests liboqs
     - name: Save liboqs to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.liboqs_SOURCE && ! steps.restore_liboqs.outputs.cache-hit }}
@@ -394,7 +394,7 @@ jobs:
        key: ${{ steps.paths.outputs.autoconf_CACHE_KEY }}-install
     - name: Build autoconf
       if: ${{ steps.paths.outputs.autoconf_SOURCE && ! steps.restore_autoconf.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests autoconf
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests autoconf
     - name: Save autoconf to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.autoconf_SOURCE && ! steps.restore_autoconf.outputs.cache-hit }}
@@ -410,7 +410,7 @@ jobs:
        key: ${{ steps.paths.outputs.automake_CACHE_KEY }}-install
     - name: Build automake
       if: ${{ steps.paths.outputs.automake_SOURCE && ! steps.restore_automake.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests automake
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests automake
     - name: Save automake to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.automake_SOURCE && ! steps.restore_automake.outputs.cache-hit }}
@@ -426,7 +426,7 @@ jobs:
        key: ${{ steps.paths.outputs.libtool_CACHE_KEY }}-install
     - name: Build libtool
       if: ${{ steps.paths.outputs.libtool_SOURCE && ! steps.restore_libtool.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libtool
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libtool
     - name: Save libtool to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libtool_SOURCE && ! steps.restore_libtool.outputs.cache-hit }}
@@ -442,7 +442,7 @@ jobs:
        key: ${{ steps.paths.outputs.gperf_CACHE_KEY }}-install
     - name: Build gperf
       if: ${{ steps.paths.outputs.gperf_SOURCE && ! steps.restore_gperf.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests gperf
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests gperf
     - name: Save gperf to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.gperf_SOURCE && ! steps.restore_gperf.outputs.cache-hit }}
@@ -458,7 +458,7 @@ jobs:
        key: ${{ steps.paths.outputs.libiberty_CACHE_KEY }}-install
     - name: Build libiberty
       if: ${{ steps.paths.outputs.libiberty_SOURCE && ! steps.restore_libiberty.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libiberty
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libiberty
     - name: Save libiberty to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libiberty_SOURCE && ! steps.restore_libiberty.outputs.cache-hit }}
@@ -474,7 +474,7 @@ jobs:
        key: ${{ steps.paths.outputs.libsodium_CACHE_KEY }}-install
     - name: Build libsodium
       if: ${{ steps.paths.outputs.libsodium_SOURCE && ! steps.restore_libsodium.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libsodium
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libsodium
     - name: Save libsodium to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libsodium_SOURCE && ! steps.restore_libsodium.outputs.cache-hit }}
@@ -490,7 +490,7 @@ jobs:
        key: ${{ steps.paths.outputs.libunwind_CACHE_KEY }}-install
     - name: Build libunwind
       if: ${{ steps.paths.outputs.libunwind_SOURCE && ! steps.restore_libunwind.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests libunwind
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests libunwind
     - name: Save libunwind to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.libunwind_SOURCE && ! steps.restore_libunwind.outputs.cache-hit }}
@@ -506,7 +506,7 @@ jobs:
        key: ${{ steps.paths.outputs.xz_CACHE_KEY }}-install
     - name: Build xz
       if: ${{ steps.paths.outputs.xz_SOURCE && ! steps.restore_xz.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests xz
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests xz
     - name: Save xz to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.xz_SOURCE && ! steps.restore_xz.outputs.cache-hit }}
@@ -522,7 +522,7 @@ jobs:
        key: ${{ steps.paths.outputs.folly_CACHE_KEY }}-install
     - name: Build folly
       if: ${{ steps.paths.outputs.folly_SOURCE && ! steps.restore_folly.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests folly
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests folly
     - name: Save folly to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.folly_SOURCE && ! steps.restore_folly.outputs.cache-hit }}
@@ -538,7 +538,7 @@ jobs:
        key: ${{ steps.paths.outputs.fizz_CACHE_KEY }}-install
     - name: Build fizz
       if: ${{ steps.paths.outputs.fizz_SOURCE && ! steps.restore_fizz.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests fizz
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests fizz
     - name: Save fizz to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.fizz_SOURCE && ! steps.restore_fizz.outputs.cache-hit }}
@@ -554,7 +554,7 @@ jobs:
        key: ${{ steps.paths.outputs.mvfst_CACHE_KEY }}-install
     - name: Build mvfst
       if: ${{ steps.paths.outputs.mvfst_SOURCE && ! steps.restore_mvfst.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests mvfst
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests mvfst
     - name: Save mvfst to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.mvfst_SOURCE && ! steps.restore_mvfst.outputs.cache-hit }}
@@ -570,7 +570,7 @@ jobs:
        key: ${{ steps.paths.outputs.wangle_CACHE_KEY }}-install
     - name: Build wangle
       if: ${{ steps.paths.outputs.wangle_SOURCE && ! steps.restore_wangle.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests wangle
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests wangle
     - name: Save wangle to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.wangle_SOURCE && ! steps.restore_wangle.outputs.cache-hit }}
@@ -586,7 +586,7 @@ jobs:
        key: ${{ steps.paths.outputs.proxygen_CACHE_KEY }}-install
     - name: Build proxygen
       if: ${{ steps.paths.outputs.proxygen_SOURCE && ! steps.restore_proxygen.outputs.cache-hit }}
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --no-tests proxygen
+      run: python3 build/fbcode_builder/getdeps.py build --no-tests proxygen
     - name: Save proxygen to cache
       uses: actions/cache/save@v4
       if: ${{ steps.paths.outputs.proxygen_SOURCE && ! steps.restore_proxygen.outputs.cache-hit }}
@@ -594,12 +594,12 @@ jobs:
        path: ${{ steps.paths.outputs.proxygen_INSTALL }}
        key: ${{ steps.paths.outputs.proxygen_CACHE_KEY }}-install
     - name: Build moxygen
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages build --src-dir=. moxygen --project-install-prefix moxygen:/usr/local
+      run: python3 build/fbcode_builder/getdeps.py build --src-dir=. moxygen --project-install-prefix moxygen:/usr/local
     - name: Copy artifacts
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages fixup-dyn-deps --strip --src-dir=. moxygen _artifacts/mac --project-install-prefix moxygen:/usr/local --final-install-prefix /usr/local
+      run: python3 build/fbcode_builder/getdeps.py fixup-dyn-deps --strip --src-dir=. moxygen _artifacts/mac --project-install-prefix moxygen:/usr/local --final-install-prefix /usr/local
     - uses: actions/upload-artifact@v4
       with:
         name: moxygen
         path: _artifacts
     - name: Test moxygen
-      run: python3 build/fbcode_builder/getdeps.py --allow-system-packages test --src-dir=. moxygen --project-install-prefix moxygen:/usr/local
\ No newline at end of file
+      run: python3 build/fbcode_builder/getdeps.py test --src-dir=. moxygen --project-install-prefix moxygen:/usr/local
\ No newline at end of file
-- 
2.34.1

